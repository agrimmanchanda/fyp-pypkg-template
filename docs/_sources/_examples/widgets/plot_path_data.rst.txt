
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "_examples\widgets\plot_path_data.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download__examples_widgets_plot_path_data.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr__examples_widgets_plot_path_data.py:


Pathology Data
===========================

.. GENERATED FROM PYTHON SOURCE LINES 5-129



.. image:: /_examples/widgets/images/sphx_glr_plot_path_data_001.png
    :alt: Correlation Matrix for FBC panel, Histogram and PDF of FBC panel correlations
    :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none


    Sorted mean correlation values by biomarkers:
    MCHC     0.382059
    MCV      0.339479
    MCH      0.333648
    HCT      0.310809
    HGB      0.309879
    RBC      0.287938
    WBC      0.284212
    MPV      0.264828
    MONO     0.247071
    NEUT     0.224800
    RDW      0.203640
    PLT      0.175753
    BASO     0.174066
    LY       0.162445
    EOS      0.141364
    NRBCA    0.086158
    dtype: float64






|

.. code-block:: default
   :lineno-start: 5

    # Import
    import numpy as np
    import pandas as pd
    import seaborn as sns 
    import matplotlib.pyplot as plt
    import warnings
    warnings.filterwarnings("ignore")

    # DataBlend library
    from pkgname.utils.widgets import TidyWidget

    # ------------------------
    # Data handling 
    # ------------------------
    # Define FBC panel and interest biochemical markers

    FBC_codes = ["EOS", "MONO", "BASO", "NEUT", "RBC", "WBC", 
                    "MCHC", "MCV", "LY", "HCT", "RDW", "HGB", 
                    "MCH", "PLT", "MPV", "NRBCA"]

    INTEREST_cols = ["_uid","dateResult", "orderCode", "result", "unit", "unitRange"]

    # Parameters
    index = ['_uid', 'dateResult', 'orderCode']
    value = 'result'

    # Function to sort by pid, datetime value

    def change_pid_datetime_format(df):
        df['pid'] = df['_uid'].str.extract('(\d+)').astype(int)

        pid_col = df.pop('pid')

        df.insert(0, 'pid', pid_col)

        df.drop('_uid', inplace=True, axis=1)

        df.sort_values(by=['pid', 'dateResult'], inplace=True)

        return df


    # --------------------
    # Main
    # --------------------

    # Import feature vector of biochemical markers and FBC panel results

    path_data = '../load_dataset/datasets/pathology-sample-march-may.csv'

    data = pd.read_csv(path_data, usecols=INTEREST_cols)

    data = data.loc[data['orderCode'].isin(FBC_codes)]

    data = data.dropna() # drop records of patients with NaN _uid

    data.reset_index(drop=True, inplace=True)

    # Create widget
    widget = TidyWidget(index=index, value=value)

    # Transform (keep all)
    transform, duplicated = \
        widget.transform(data, report_duplicated=True)

    # Set pid for each patient and sort accordingly
    transform_fmt = change_pid_datetime_format(transform)

    # Transform (keep first)
    transform_first = \
        widget.transform(data, keep='first')

    # Set pid for each patient and sort accordingly
    transform_first_fmt = change_pid_datetime_format(transform_first)

    biomarkers_df = transform_fmt.iloc[:,2:]

    # Obtain the correlation matrix for the biomarkers

    corr_mat = biomarkers_df.dropna().corr()

    # Print the mean correlation value for each biomarker

    print("\nSorted mean correlation values by biomarkers:")
    print(corr_mat.mean(1).sort_values(ascending=False))

    # Plot seaborn heatmap, histogram and PDF of correlation values.

    plt.figure(figsize=(20,8))
    plt.subplot(1,2,1)
    plt.title('Correlation Matrix for FBC panel', fontweight='bold', fontsize=15)

    min_v = corr_mat.values.min()
    ax = sns.heatmap(
        corr_mat, 
        vmin=min_v, vmax=1, center=0,
        cmap=sns.diverging_palette(20, 220, n=200),
        square=True,
        annot = True,
        annot_kws={"fontsize":8}
    )
    ax.set_xticklabels(
        ax.get_xticklabels(),
        rotation=45,
        horizontalalignment='right',
        fontsize=15
    );

    ax.set_yticklabels(
        ax.get_yticklabels(),
        fontsize=15
    );

    ax.set_yticklabels(biomarkers_df.columns)
    ax.set_xticklabels(biomarkers_df.columns)

    plt.subplot(1,2,2)
    plt.title('Histogram and PDF of FBC panel correlations', fontweight='bold', fontsize=15)
    sns.distplot(corr_mat.values.reshape(-1), bins=50, kde_kws={'color': 'red','linewidth': 2, }, hist_kws={'edgecolor':'black'})
    plt.ylabel("Density", fontsize=18)
    plt.xlabel("Correlation values", fontsize=15)
    plt.xticks(fontsize=15)
    plt.yticks(fontsize=15)
    plt.grid()
    plt.show()

.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  20.565 seconds)


.. _sphx_glr_download__examples_widgets_plot_path_data.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_path_data.py <plot_path_data.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_path_data.ipynb <plot_path_data.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
